From 8a12c0af340f0854a0e0235f85c6e3fee40f5c1f Mon Sep 17 00:00:00 2001
From: Jerry <724733136@qq.com>
Date: Tue, 12 Dec 2017 14:34:26 +0800
Subject: [PATCH] patch for 82599

---
 drivers/net/ixgbe/base/ixgbe_82598.c  | 32 ++++++++++++++++----------------
 drivers/net/ixgbe/base/ixgbe_common.c | 30 +++++++++++++++---------------
 2 files changed, 31 insertions(+), 31 deletions(-)

diff --git a/drivers/net/ixgbe/base/ixgbe_82598.c b/drivers/net/ixgbe/base/ixgbe_82598.c
index d64abb2..59f6b22 100755
--- a/drivers/net/ixgbe/base/ixgbe_82598.c
+++ b/drivers/net/ixgbe/base/ixgbe_82598.c
@@ -252,8 +252,8 @@ s32 ixgbe_init_phy_ops_82598(struct ixgbe_hw *hw)
  **/
 s32 ixgbe_start_hw_82598(struct ixgbe_hw *hw)
 {
-	u32 regval;
-	u32 i;
+//	u32 regval;
+//	u32 i;
 	s32 ret_val = IXGBE_SUCCESS;
 
 	DEBUGFUNC("ixgbe_start_hw_82598");
@@ -263,20 +263,20 @@ s32 ixgbe_start_hw_82598(struct ixgbe_hw *hw)
 		return ret_val;
 
 	/* Disable relaxed ordering */
-	for (i = 0; ((i < hw->mac.max_tx_queues) &&
-	     (i < IXGBE_DCA_MAX_QUEUES_82598)); i++) {
-		regval = IXGBE_READ_REG(hw, IXGBE_DCA_TXCTRL(i));
-		regval &= ~IXGBE_DCA_TXCTRL_DESC_WRO_EN;
-		IXGBE_WRITE_REG(hw, IXGBE_DCA_TXCTRL(i), regval);
-	}
-
-	for (i = 0; ((i < hw->mac.max_rx_queues) &&
-	     (i < IXGBE_DCA_MAX_QUEUES_82598)); i++) {
-		regval = IXGBE_READ_REG(hw, IXGBE_DCA_RXCTRL(i));
-		regval &= ~(IXGBE_DCA_RXCTRL_DATA_WRO_EN |
-			    IXGBE_DCA_RXCTRL_HEAD_WRO_EN);
-		IXGBE_WRITE_REG(hw, IXGBE_DCA_RXCTRL(i), regval);
-	}
+//	for (i = 0; ((i < hw->mac.max_tx_queues) &&
+//	     (i < IXGBE_DCA_MAX_QUEUES_82598)); i++) {
+//		regval = IXGBE_READ_REG(hw, IXGBE_DCA_TXCTRL(i));
+//		regval &= ~IXGBE_DCA_TXCTRL_DESC_WRO_EN;
+//		IXGBE_WRITE_REG(hw, IXGBE_DCA_TXCTRL(i), regval);
+//	}
+//
+//	for (i = 0; ((i < hw->mac.max_rx_queues) &&
+//	     (i < IXGBE_DCA_MAX_QUEUES_82598)); i++) {
+//		regval = IXGBE_READ_REG(hw, IXGBE_DCA_RXCTRL(i));
+//		regval &= ~(IXGBE_DCA_RXCTRL_DATA_WRO_EN |
+//			    IXGBE_DCA_RXCTRL_HEAD_WRO_EN);
+//		IXGBE_WRITE_REG(hw, IXGBE_DCA_RXCTRL(i), regval);
+//	}
 
 	/* set the completion timeout for interface */
 	ixgbe_set_pcie_completion_timeout(hw);
diff --git a/drivers/net/ixgbe/base/ixgbe_common.c b/drivers/net/ixgbe/base/ixgbe_common.c
index 4dabb43..a97209e 100755
--- a/drivers/net/ixgbe/base/ixgbe_common.c
+++ b/drivers/net/ixgbe/base/ixgbe_common.c
@@ -453,7 +453,7 @@ s32 ixgbe_start_hw_generic(struct ixgbe_hw *hw)
 s32 ixgbe_start_hw_gen2(struct ixgbe_hw *hw)
 {
 	u32 i;
-	u32 regval;
+//	u32 regval;
 
 	/* Clear the rate limiters */
 	for (i = 0; i < hw->mac.max_tx_queues; i++) {
@@ -461,20 +461,20 @@ s32 ixgbe_start_hw_gen2(struct ixgbe_hw *hw)
 		IXGBE_WRITE_REG(hw, IXGBE_RTTBCNRC, 0);
 	}
 	IXGBE_WRITE_FLUSH(hw);
-
-	/* Disable relaxed ordering */
-	for (i = 0; i < hw->mac.max_tx_queues; i++) {
-		regval = IXGBE_READ_REG(hw, IXGBE_DCA_TXCTRL_82599(i));
-		regval &= ~IXGBE_DCA_TXCTRL_DESC_WRO_EN;
-		IXGBE_WRITE_REG(hw, IXGBE_DCA_TXCTRL_82599(i), regval);
-	}
-
-	for (i = 0; i < hw->mac.max_rx_queues; i++) {
-		regval = IXGBE_READ_REG(hw, IXGBE_DCA_RXCTRL(i));
-		regval &= ~(IXGBE_DCA_RXCTRL_DATA_WRO_EN |
-			    IXGBE_DCA_RXCTRL_HEAD_WRO_EN);
-		IXGBE_WRITE_REG(hw, IXGBE_DCA_RXCTRL(i), regval);
-	}
+//
+//	/* Disable relaxed ordering */
+//	for (i = 0; i < hw->mac.max_tx_queues; i++) {
+//		regval = IXGBE_READ_REG(hw, IXGBE_DCA_TXCTRL_82599(i));
+//		regval &= ~IXGBE_DCA_TXCTRL_DESC_WRO_EN;
+//		IXGBE_WRITE_REG(hw, IXGBE_DCA_TXCTRL_82599(i), regval);
+//	}
+//
+//	for (i = 0; i < hw->mac.max_rx_queues; i++) {
+//		regval = IXGBE_READ_REG(hw, IXGBE_DCA_RXCTRL(i));
+//		regval &= ~(IXGBE_DCA_RXCTRL_DATA_WRO_EN |
+//			    IXGBE_DCA_RXCTRL_HEAD_WRO_EN);
+//		IXGBE_WRITE_REG(hw, IXGBE_DCA_RXCTRL(i), regval);
+//	}
 
 	return IXGBE_SUCCESS;
 }
-- 
2.7.4

